addpath('/home/louic/Desktop/mvapack');
%icoshift data make sure to make ppm a separate file
%add directory where files are
directory = "/home/louic/Desktop/parkinsons_project/full_run/";
%load spectra and ppm files
spectra  = load(strcat(directory, "raw_spect"));

ppm = spectra(1,:);
spectra = spectra(2:end,:);

	    
segments = [0.69 0.76; 0.78 0.84; 0.84 0.93; 0.93 0.99; 0.99 1.03;...
	    1.03 1.08; 1.08 1.10; 1.10 1.13; 1.13 1.14; 1.14 1.21;...
	    1.21 1.26; 1.26 1.33; 1.35 1.43; 1.46 1.524; 1.524 1.6;...
	    1.78 1.82; 1.82 1.84; 1.84 1.91; 1.91 1.96; 1.96 1.97;...
	    1.97 2.00; 2.00 2.02; 2.02 2.03; 2.03 2.08; 2.14 2.22;...
	    2.22 2.29; 2.32 2.42; 2.42 2.52; 2.54 2.58; 2.58 2.62;...
	    2.62 2.71; 2.71 2.80; 2.80 2.85; 2.85 2.92; 2.92 2.95;...
	    2.95 2.99; 2.99 3.08; 3.10 3.12; 3.12 3.126; 3.126 3.14;...
	    3.14 3.166; 3.166 3.22; 3.22 3.24; 3.24 3.28; 3.28 3.33;...
	    3.33 3.35; 3.35 3.37; 3.37 3.47; 3.52 3.55; 3.55 3.635;...
	    3.635 3.674; 3.674 3.78; 3.78 3.84; 5.45 5.50; 5.79 5.82;...
	    5.85 5.87; 6.20 6.28; 6.28 6.30; 6.35 6.40; 6.40 6.43;...
	    6.50 6.53; 6.67 6.74; 6.74 6.77; 6.77 6.79; 6.79 6.83;...
	    6.83 6.93; 7.00 7.10; 7.10 7.21; 7.21 7.29; 7.29 7.35;...
	    7.35 7.40; 7.40 7.46; 8.44 8.48; 8.69 8.74; 8.75 8.80;...
	    8.93 8.96; 9.00 9.15; 9.15 9.25];
	    
	  
%exectution 
%global then segmented
shifted = icoshift(spectra, ppm, segments, cofirst =false);
%optimal binning of spectra if desired
[xnew, abnew]=binoptim(shifted, ppm, 0.001);

%merge ppm and data and save
ppm_bin = strcat(directory, "ppm_bin");
bin_shift_data = strcat(directory, "bin_shift_data");

shifted = [ppm;shifted];
abnew = transpose(abnew);
xnew = [abnew;xnew];

save("-text", bin_shift_data, "xnew");

%if you didnt bin then save the shifted spectra
shifted_data = strcat(directory, "shifted_data");
save("-text", shifted_data, "shifted");